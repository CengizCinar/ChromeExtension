"use strict";import{mutableData}from"../constants/mutableData.js";import{showSasExtensionMessage}from"./showSasExtensionMessage.js";import{backgroundScriptMessages}from"../constants/backgroundScriptMessages.js";import{toggleSASPanel}from"./toggleSASPanel/toggleSASPanel.js";import{showSASPanel}from"./toggleSASPanel/showSASPanel.js";import{loadSasScript}from"./loadSasScript/loadSasScript.js";import{showPopup}from"./showPopup.js";import{documentReadyHandler}from"./documentReadyHandler.js";import{setImageSearchUrl,setUrl}from"./urlsService/setUrl.js";const launchContent=async()=>{chrome.runtime.onMessage.addListener(async(a,e,s)=>{if(a.command===backgroundScriptMessages.SHOW_SAS_EXTENSION)s({result:!0,command_name:a.command}),await showSasExtensionMessage(a);else if(a.command===backgroundScriptMessages.DO_IMAGE_SEARCH){var o=a.source_url;setImageSearchUrl(o),$("#loadingMessage").addClass("sasdklgc-display"),await showSASPanel(!1)}else if(a.command===backgroundScriptMessages.DO_SAS){s({farewell:"goodbye"}),$("#sasFrame").removeClass("sasdklgc-display");let e=a.selectionText;o=a.linkUrl||a.source_url;a.smartSearch&&!a.linkUrl?e=!1:(e=e&&"undefined"!=e?e:$(":focus").text())&&"undefined"!=e||(e=$(":focus").find("img").attr("alt")),await setUrl(e,null,null,o),$("#loadingMessage").addClass("sasdklgc-display"),1==a.no_display_update?mutableData.gDisplay&&showSASPanel():await showSASPanel()}else a.command===backgroundScriptMessages.TOGGLE_SAS?(s({farewell:"goodbye"}),toggleSASPanel()):a.command===backgroundScriptMessages.TOGGLE_POPUP?(showPopup("test"),s({farewell:"goodbye"})):a.command===backgroundScriptMessages.GET_HTML?s({html:document.documentElement.outerHTML}):a.command===backgroundScriptMessages.SHOW_ALERT?(window.dialog.show({title:a.title,content:a.message,okText:"Close",isCancelable:!1,onOk:()=>{window.location.reload()}}),s({isSent:!0})):a.command===backgroundScriptMessages.CHECK_INJECTION&&s({status:"injected"})}),await loadSasScript(),$(document).ready(documentReadyHandler)};export{launchContent};