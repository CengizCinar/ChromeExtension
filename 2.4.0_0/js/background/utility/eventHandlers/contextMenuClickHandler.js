"use strict";import{sentrySellerAmp}from"../../../content/sentrySellerAmp/sentrySellerAmp.js";import{handleScriptInjection}from"../injectContentIntoTabs.js";import{contentScriptMessages}from"../../../content/constants/contentScriptMessages.js";import{CONTENT_SCRIPT_STATUSES}from"../../constants/contentScriptStatus.js";const contextMenuClickHandler=async(e,t)=>{sentrySellerAmp.wrap(function(){handleEvent(e,t)})},handleEvent=async(e,t)=>{await makeAction(e,t)},makeAction=async(e,t)=>{switch(e.menuItemId){case"cmSas":case"cmSasPage":case"cmSasLink":await activateTab(t,async()=>doSas(e,t));break;case"cmPopup":await activateTab(t,async()=>togglePopup(e,t));break;case"cmSasImage":await activateTab(t,async()=>doImageSearch(e,t))}},activateTab=async(a,s)=>{const n=async(e,t)=>{if(e?.message===contentScriptMessages.READY&&t.tab.id===a.id)try{await s()}finally{chrome.runtime.onMessage.removeListener(n)}else e?.message===contentScriptMessages.UNLOADED&&t.tab?.id===a.id&&chrome.runtime.onMessage.removeListener(n)};chrome.runtime.onMessage.addListener(n);try{var e=await handleScriptInjection(a);e.contentScriptStatus===CONTENT_SCRIPT_STATUSES.READY?(chrome.runtime.onMessage.removeListener(n),await s()):e.contentScriptStatus===CONTENT_SCRIPT_STATUSES.UNLOADED&&chrome.runtime.onMessage.removeListener(n)}catch(e){console.log(e)}},doSas=async(e,t)=>chrome.tabs.sendMessage(t.id,{command:"dosas",selectionText:e.selectionText,linkUrl:e.linkUrl,pageUrl:e.pageUrl,source_url:t.url,smartSearch:"cmSasPage"===e.menuItemId,linkSearch:"cmSasLink"===e.menuItemId}),togglePopup=async(e,t)=>chrome.tabs.sendMessage(t.id,{command:"togglePopup",source_url:t.url}),doImageSearch=async(e,t)=>chrome.tabs.sendMessage(t.id,{command:"doImageSearch",source_url:e?.srcUrl});export{contextMenuClickHandler};